# Vercel Production Setup - Complete Guide

## Step-by-Step: Deploy Multi-Tenant SaaS with Wildcard Subdomains

This guide will help you deploy your GoldSaver platform to Vercel with wildcard subdomain support so each retailer gets their own branded URL.

---

## Prerequisites

- [ ] GitHub account with your code pushed
- [ ] Vercel account (free tier works!)
- [ ] Domain name (e.g., `goldsaver.com` or `yourbusiness.com`)
- [ ] Access to your domain registrar (GoDaddy, Namecheap, Google Domains, etc.)

---

## Part 1: Deploy to Vercel (10 minutes)

### Step 1.1: Push Code to GitHub

If you haven't already:

```powershell
# Initialize git (if not done)
git init

# Add all files
git add .

# Commit
git commit -m "Add subdomain-based multi-tenant support"

# Create GitHub repo and push
# (Follow GitHub's instructions to create new repo)
git remote add origin https://github.com/YourUsername/gold-savings-scheme-platform.git
git branch -M main
git push -u origin main
```

### Step 1.2: Import to Vercel

1. **Go to Vercel**: https://vercel.com
2. **Sign up/Login** with GitHub
3. **Click "Add New..."** â†’ "Project"
4. **Import your repository**:
   - Find: `gold-savings-scheme-platform`
   - Click "Import"

### Step 1.3: Configure Build Settings

Vercel should auto-detect Next.js settings:

```
Framework Preset: Next.js
Build Command: npm run build
Output Directory: .next
Install Command: npm install
```

### Step 1.4: Add Environment Variables

Click "Environment Variables" and add:

```
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
```

**Get these from**: Supabase Dashboard â†’ Project Settings â†’ API

### Step 1.5: Deploy

1. Click "Deploy"
2. Wait 2-3 minutes for build to complete
3. You'll get a URL like: `https://gold-savings-scheme-platform.vercel.app`

**Test it**: Visit the Vercel URL â†’ should see login page with "Sync4AI"

---

## Part 2: Add Custom Domain (5 minutes)

### Step 2.1: Add Root Domain to Vercel

1. **In Vercel Dashboard**:
   - Go to your project
   - Click "Settings" tab
   - Click "Domains" in sidebar

2. **Add domain**:
   - Enter: `goldsaver.com` (or your domain)
   - Click "Add"

3. **Vercel shows DNS records** you need to add:
   ```
   Type: A
   Name: @ (or leave blank)
   Value: 76.76.21.21
   
   Type: CNAME
   Name: www
   Value: cname.vercel-dns.com
   ```

### Step 2.2: Configure DNS at Your Registrar

**Example: GoDaddy**

1. **Login to GoDaddy** â†’ "My Products" â†’ "Domains"
2. Click your domain â†’ "DNS" â†’ "Manage DNS"
3. **Add A Record**:
   - Type: `A`
   - Name: `@`
   - Value: `76.76.21.21`
   - TTL: `600` (10 minutes)
   - Click "Add Record"

4. **Add/Edit CNAME Record** (for www):
   - Type: `CNAME`
   - Name: `www`
   - Value: `cname.vercel-dns.com`
   - TTL: `600`
   - Click "Save"

**Example: Namecheap**

1. **Login to Namecheap** â†’ "Domain List"
2. Click "Manage" next to your domain
3. Go to "Advanced DNS" tab
4. **Add A Record**:
   - Type: `A Record`
   - Host: `@`
   - Value: `76.76.21.21`
   - TTL: `Automatic`
   - Click âœ“ (checkmark)

5. **Add CNAME**:
   - Type: `CNAME Record`
   - Host: `www`
   - Value: `cname.vercel-dns.com`
   - TTL: `Automatic`

**Example: Cloudflare**

1. **Login to Cloudflare** â†’ Select your domain
2. Go to "DNS" â†’ "Records"
3. **Add A Record**:
   - Type: `A`
   - Name: `@`
   - IPv4 address: `76.76.21.21`
   - Proxy status: â˜ï¸ Proxied (orange cloud)
   - Click "Save"

4. **Add CNAME**:
   - Type: `CNAME`
   - Name: `www`
   - Target: `cname.vercel-dns.com`
   - Proxy status: â˜ï¸ Proxied
   - Click "Save"

### Step 2.3: Wait for DNS Propagation

- **Time**: 5 minutes to 48 hours (usually 10-30 minutes)
- **Check status**: Back in Vercel â†’ Domains â†’ Shows "Valid Configuration" when ready

**Test DNS propagation**:
```powershell
# Check if domain points to Vercel
nslookup goldsaver.com
# Should show IP: 76.76.21.21
```

### Step 2.4: Verify Domain Works

1. Visit: `https://goldsaver.com`
2. Should see your login page
3. SSL certificate auto-generated by Vercel

---

## Part 3: Add Wildcard Subdomain (THE KEY STEP!)

This allows **unlimited subdomains** like:
- `retailer1.goldsaver.com`
- `jairajendra.goldsaver.com`
- `anyname.goldsaver.com`

### Step 3.1: Add Wildcard Domain in Vercel

1. **In Vercel** â†’ Project â†’ Settings â†’ Domains
2. **Add domain**:
   - Enter: `*.goldsaver.com`
   - Click "Add"

3. **Vercel shows DNS record**:
   ```
   Type: CNAME
   Name: * (asterisk)
   Value: cname.vercel-dns.com
   ```

### Step 3.2: Add Wildcard CNAME to DNS

**GoDaddy**:

1. Go to DNS settings
2. **Add CNAME Record**:
   - Type: `CNAME`
   - Name: `*` (asterisk symbol)
   - Value: `cname.vercel-dns.com`
   - TTL: `600`
   - Click "Add Record"

**Namecheap**:

1. Go to "Advanced DNS"
2. **Add CNAME**:
   - Type: `CNAME Record`
   - Host: `*`
   - Value: `cname.vercel-dns.com`
   - TTL: `Automatic`
   - Click âœ“

**Cloudflare**:

1. Go to DNS â†’ Records
2. **Add CNAME**:
   - Type: `CNAME`
   - Name: `*`
   - Target: `cname.vercel-dns.com`
   - Proxy status: â˜ï¸ Proxied (orange cloud)
   - Click "Save"

### Step 3.3: Verify Wildcard DNS

Wait 5-30 minutes, then test:

```powershell
# Test wildcard subdomain
nslookup testsubdomain.goldsaver.com
# Should resolve to Vercel's IP
```

### Step 3.4: Verify in Vercel

Back in Vercel â†’ Domains â†’ Should show:

```
âœ“ goldsaver.com               Valid Configuration
âœ“ www.goldsaver.com          Valid Configuration
âœ“ *.goldsaver.com            Valid Configuration
```

---

## Part 4: Test Multi-Tenant Subdomains

### Step 4.1: Create Test Retailer with Subdomain

In Supabase SQL Editor:

```sql
-- Insert test retailer
INSERT INTO retailers (
  business_name,
  name,
  subdomain,
  contact_email,
  contact_phone,
  address,
  city,
  state,
  pincode
) VALUES (
  'Demo Jewellers',
  'Demo Jewellers',
  'demo',  -- This becomes demo.goldsaver.com
  'demo@example.com',
  '+919999999999',
  'Test Address',
  'Mumbai',
  'Maharashtra',
  '400001'
) RETURNING id;
```

Copy the `id` returned.

### Step 4.2: Create Admin User

1. Supabase Dashboard â†’ Authentication â†’ Users â†’ "Add User"
2. Email: `admin@demo.com`
3. Password: `demo123456`
4. Auto-confirm: âœ…
5. Copy `user_id`

### Step 4.3: Link User to Retailer

```sql
INSERT INTO user_profiles (
  id,           -- Same as user_id from Supabase Auth
  retailer_id,  -- From Step 4.1
  role,
  full_name,
  phone_number
) VALUES (
  '<user_id from Step 4.2>',
  '<retailer_id from Step 4.1>',
  'ADMIN',
  'Demo Admin',
  '+919999999999'
);
```

### Step 4.4: Test Subdomain Login

1. **Visit**: `https://demo.goldsaver.com/login`

2. **Should see**:
   - Gold banner: **"Demo Jewellers"**
   - Footer: **"Â© 2026 Demo Jewellers"**
   - No errors in console

3. **Login**:
   - Email: `admin@demo.com`
   - Password: `demo123456`
   - Redirects to: `https://demo.goldsaver.com/pulse`

4. **Verify branding persists**:
   - Top bar shows: "Demo Jewellers"
   - All data filtered by this retailer

---

## Part 5: SSL Certificate (Automatic!)

Vercel automatically generates SSL certificates for:
- âœ… Root domain: `https://goldsaver.com`
- âœ… www subdomain: `https://www.goldsaver.com`
- âœ… Wildcard subdomains: `https://anything.goldsaver.com`

**No additional configuration needed!**

Check certificate:
1. Visit: `https://demo.goldsaver.com`
2. Click padlock icon in browser
3. Should show: "Certificate (Valid)"

---

## Part 6: Onboard Real Retailers

### For Each New Retailer:

1. **Choose subdomain**: e.g., `jairajendra` for Jai Rajendra Jewels

2. **Run SQL**:
   ```sql
   -- Insert retailer
   INSERT INTO retailers (
     business_name, name, subdomain,
     contact_email, contact_phone,
     address, city, state, pincode
   ) VALUES (
     'Jai Rajendra Jewels', 
     'Jai Rajendra Jewels', 
     'jairajendra',  -- Becomes jairajendra.goldsaver.com
     'contact@jairajendra.com',
     '+919876543210',
     'MG Road, Shop 45',
     'Mumbai',
     'Maharashtra',
     '400001'
   ) RETURNING id;
   ```

3. **Create admin user** in Supabase Auth

4. **Link via user_profiles**

5. **Share URL with client**: `https://jairajendra.goldsaver.com/login`

**Time per retailer**: ~5 minutes

---

## Part 7: Custom Domains for Enterprise Clients (Optional)

Some retailers may want their **own domain** (e.g., `myjewelry.com` instead of `myjewelry.goldsaver.com`).

### Step 7.1: Add Their Domain to Vercel

1. In Vercel â†’ Domains
2. Add: `myjewelry.com`
3. Vercel provides DNS records

### Step 7.2: Retailer Updates Their DNS

They add to their domain registrar:
```
Type: CNAME
Name: @
Value: cname.vercel-dns.com
```

### Step 7.3: Link Domain to Subdomain

The retailer's domain will still use the `subdomain` field in database:

```sql
-- Update retailer with custom domain
UPDATE retailers 
SET custom_domain = 'myjewelry.com'
WHERE subdomain = 'jairajendra';
```

Then modify `lib/utils/subdomain.ts` to check for custom domains first.

---

## Troubleshooting

### Issue: "Domain not found" after adding to Vercel

**Solution**:
- Wait 10-30 minutes for DNS propagation
- Check DNS records are correct: `nslookup goldsaver.com`
- Ensure A record points to `76.76.21.21`
- Ensure CNAME points to `cname.vercel-dns.com`

### Issue: Wildcard subdomain not working

**Solution**:
- Verify `*` CNAME record exists in DNS
- Check: `nslookup random.goldsaver.com` should resolve
- Cloudflare users: Ensure proxy is enabled (orange cloud)
- Wait longer (wildcard DNS can take 1-2 hours)

### Issue: SSL certificate error

**Solution**:
- Vercel auto-generates certs, but may take 5-10 minutes
- Check Vercel â†’ Domains â†’ Should show green checkmark
- Try accessing `http://` first, then `https://`
- Clear browser cache (Ctrl+Shift+Delete)

### Issue: Shows "Sync4AI" instead of retailer name

**Check**:
1. Migration ran successfully? Run: `SELECT subdomain FROM retailers;`
2. Retailer exists with correct subdomain?
3. Browser console shows detected subdomain?
4. Public branding policy exists? Check RLS policies.

**Fix**:
```sql
-- Verify retailer
SELECT * FROM retailers WHERE subdomain='demo';

-- Check RLS policy
SELECT * FROM pg_policies WHERE tablename='retailers';
```

### Issue: "Invalid Configuration" in Vercel Domains

**Solution**:
- DNS not propagated yet â†’ Wait longer
- Wrong DNS records â†’ Verify A and CNAME values
- Registrar blocking external DNS â†’ Contact support
- Using registrar's DNS service? â†’ May need to upgrade plan

---

## Cost Breakdown (Production)

### Vercel Pricing:
- **Hobby (Free)**: 
  - âœ… Unlimited deployments
  - âœ… 100GB bandwidth/month
  - âœ… SSL certificates included
  - âœ… Custom domains + wildcards
  - âš ï¸ Limit: Commercial use not allowed

- **Pro ($20/month)**:
  - âœ… 1TB bandwidth
  - âœ… Commercial use allowed
  - âœ… Team collaboration
  - âœ… Password protection
  - **Recommended for production**

### Supabase Pricing:
- **Free Tier**:
  - âœ… 500MB database
  - âœ… 1GB file storage
  - âœ… 50,000 monthly active users
  - âš ï¸ Database pauses after 1 week inactivity

- **Pro ($25/month)**:
  - âœ… 8GB database
  - âœ… 100GB file storage
  - âœ… Unlimited MAU
  - âœ… No pausing
  - **Recommended for production**

### Domain:
- $12-15/year (GoDaddy, Namecheap)

### Total Monthly Cost:
- **Hobby/Testing**: $2/month (Supabase Pro)
- **Production**: $45/month (Vercel Pro + Supabase Pro)
- **Per additional retailer**: $0 (just database rows!)

---

## DNS Provider Comparison

### Cloudflare (Recommended)
**Pros**:
- âœ… Free plan with DDoS protection
- âœ… Fast DNS propagation (5-10 minutes)
- âœ… SSL/TLS encryption
- âœ… Easy wildcard setup
- âœ… Analytics included

**Cons**:
- âš ï¸ Must transfer domain to Cloudflare (or use nameservers)

### GoDaddy
**Pros**:
- âœ… Easy to use interface
- âœ… No domain transfer needed

**Cons**:
- âš ï¸ Slower DNS propagation (30-60 minutes)
- âš ï¸ Charges for privacy protection

### Namecheap
**Pros**:
- âœ… Free WHOIS privacy
- âœ… Good value
- âœ… Clean interface

**Cons**:
- âš ï¸ Medium DNS propagation (15-30 minutes)

---

## Summary Checklist

### One-Time Setup
- [ ] Deploy to Vercel from GitHub
- [ ] Add environment variables (Supabase keys)
- [ ] Add root domain to Vercel (`goldsaver.com`)
- [ ] Add wildcard domain to Vercel (`*.goldsaver.com`)
- [ ] Configure A record in DNS (`76.76.21.21`)
- [ ] Configure wildcard CNAME in DNS (`* â†’ cname.vercel-dns.com`)
- [ ] Wait for DNS propagation (10-30 minutes)
- [ ] Verify SSL certificates (automatic)

### Per Retailer (5 minutes each)
- [ ] Insert retailer with unique subdomain
- [ ] Create admin user in Supabase Auth
- [ ] Link user to retailer via `user_profiles`
- [ ] Test: Visit `https://subdomain.goldsaver.com/login`
- [ ] Verify branding shows correctly
- [ ] Share login URL with retailer

---

## Next Steps

1. **Deploy now**: Follow Part 1 â†’ Get Vercel URL working
2. **Add domain**: Follow Part 2 â†’ Get `goldsaver.com` working
3. **Add wildcard**: Follow Part 3 â†’ Enable unlimited subdomains
4. **Test**: Follow Part 4 â†’ Create test retailer and login
5. **Onboard**: Follow Part 6 â†’ Add real retailers

**Estimated time**: 30-60 minutes total (including DNS wait time)

---

## Visual Reference: What Your Clients See

### Client visits: `https://jairajendra.goldsaver.com/login`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ https://jairajendra.goldsaver.com   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         [LOGO if uploaded]

    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘   Jai Rajendra Jewels           â•‘  â† Gold banner
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   Premium Gold Savings Scheme Management

         âœ¨ Trusted by Jewellers

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sign In                     â”‚
    â”‚                              â”‚
    â”‚  Email: [____________]       â”‚
    â”‚  Password: [____________]    â”‚
    â”‚                              â”‚
    â”‚  [  Sign In  ]               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Â© 2026 Jai Rajendra Jewels. All rights reserved.
```

**Each retailer sees their OWN branding**, completely isolated!

---

Need help with any step? Let me know! ğŸš€
